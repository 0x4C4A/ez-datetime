angular.module("ez.datetime",[]),angular.module("ez.datetime").constant("EzDatetimeConfig",{minView:"day",startView:"day",modelFormat:void 0,viewFormat:"MMM Do YYYY [at] h:mma",modelBinding:"default",rangeEnabled:!1,timepickerEnabled:!0,secondsEnabled:!1,meridiemEnabled:!0,hourStep:1,minuteStep:15,secondStep:15,hourFormat:"h",minuteFormat:"mm",secondFormat:"ss",meridiemFormat:"A",heading:"Select a Date",rangeHeading:"Select a Start & End Date",okBtnText:"OK",cancelBtnText:"Cancel"}),angular.module("ez.datetime").controller("EzDatetimeModalController",["$scope","$modalInstance",function(a,b){a.dismiss=function(){b.dismiss()},a.ok=function(){b.close()}}]),angular.module("ez.datetime").directive("ezDatePicker",["EzDatetimeService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_date_picker.html",scope:{from:"=?",to:"=?",options:"=?"},replace:!0,link:function(b,c,d,e){b.date=null,a.resolveConfig(b,d);var f=function(a){var b=10*parseInt(moment(a).year()/10,10);return moment(a).year(b).startOf("year")},g=function(a,c,f){console.log("resol",moment(c).format("lll"));var g,h,i=moment(a).unix();b.options.rangeEnabled?d.from&&b.from?(g=moment(b.from).unix(),e.$viewValue&&c&&i>=g&&c>i&&(f.highlight=!0),g>i&&(f.unselectable=!0)):d.to&&b.to&&(h=moment(b.to).unix(),e.$viewValue&&c&&h>=i&&i>c&&(f.highlight=!0),i>h&&(f.unselectable=!0)):(b.from&&(g=moment(b.from).unix(),g>i&&(f.unselectable=!0)),b.to&&(h=moment(b.to).unix(),i>h&&(f.unselectable=!0)))},h={year:function(a){for(var c=moment().format("YYYY"),d=moment(a).startOf("year"),h=10*parseInt(d.year()/10,10),i=moment(f(a)).subtract(1,"year").startOf("year"),j=moment(e.$viewValue).year(),k=moment(e.$viewValue).unix(),l={currentView:"year",nextView:"year"===b.options.minView?"setTime":"month",previousViewDate:{unselectable:!0,dateValue:null,display:h+"-"+(h+9)},leftDate:{dateValue:moment(i).subtract(9,"year").valueOf()},rightDate:{dateValue:moment(i).add(11,"year").valueOf()},dates:[]},m=0;12>m;m+=1){var n=moment(i).add(m,"years"),o={dateValue:n,display:n.format("YYYY"),past:n.year()<h,future:n.year()>h+9,active:!!e.$viewValue&&n.year()===j,current:n.format("YYYY")===c};g(n,k,o),l.dates.push(o)}return l},month:function(a){for(var c=moment().format("YYYY-MMM"),d=moment(a).startOf("year"),h=f(a),i=moment(e.$viewValue).format("YYYY-MMM"),j=moment(e.$viewValue).unix(),k={previousView:"year",currentView:"month",nextView:"month"===b.options.minView?"setTime":"day",previousViewDate:{dateValue:h.valueOf(),display:d.format("YYYY")},leftDate:{dateValue:moment(d).subtract(1,"year").valueOf()},rightDate:{dateValue:moment(d).add(1,"year").valueOf()},dates:[]},l=0;12>l;l+=1){var m=moment(d).add(l,"months"),n={dateValue:m,display:m.format("MMM"),active:!!e.$viewValue&&m.format("YYYY-MMM")===i,current:m.format("YYYY-MMM")===c};g(m,j,n),k.dates.push(n)}return k},day:function(a){var c=a,d=moment().format("YYYY-MMM-DD"),f=moment(c).startOf("month");if(b.options.timepickerEnabled){var h=moment(e.$viewValue);f.hours(h.hours()),f.minutes(h.minutes()),f.seconds(h.seconds())}for(var i=moment(c).startOf("year"),j=moment(c).endOf("month"),k=moment(f).subtract(Math.abs(f.weekday()),"days"),l=moment(e.$viewValue).format("YYYY-MMM-DD"),m=moment(e.$viewValue).unix(),n={previousView:"month",currentView:"day",nextView:"setTime",previousViewDate:{dateValue:i.valueOf(),display:f.format("YYYY-MMM")},leftDate:{dateValue:moment(f).subtract(1,"months").valueOf()},rightDate:{dateValue:moment(f).add(1,"months").valueOf()},dayNames:[],weeks:[]},o=0;7>o;o+=1)n.dayNames.push(moment().weekday(o).format("dd"));for(var p=0;6>p;p+=1){for(var q={dates:[]},r=0;7>r;r+=1){var s=moment(k).add(7*p+r,"days"),t={dateValue:s,display:s.format("D"),active:!!e.$viewValue&&s.format("YYYY-MMM-DD")===l,current:!e.$viewValue&&s.format("YYYY-MMM-DD")===d,past:s.isBefore(f),future:s.isAfter(j)};g(s,m,t),q.dates.push(t)}n.weeks.push(q)}return n},setTime:function(a){var c=moment(a).format(b.options.modelFormat);return("x"===b.options.modelFormat||"X"===b.options.modelFormat)&&(c=parseInt(c,10)),e.$setViewValue(c),h[b.options.minView](moment(a))}};b.changeView=function(a,c,d){if(d&&(d.stopPropagation(),d.preventDefault()),b.view=a,b.view&&b.view&&!c.unselectable&&h[b.view]&&c.dateValue){if("setTime"===a&&c.dateValue.format()===moment(e.$modelValue).format())return c.active=!1,b.data.weeks.forEach(function(a){a.dates.forEach(function(a){a.highlight=!1})}),void e.$setViewValue(null);b.data=h[b.view](c.dateValue)}},e.$render=function(){b.view||(b.view=b.options.startView),b.data=h[b.view](e.$viewValue)},d.from&&b.$watch("from",function(a,b){a!==b&&(console.log("from changed",a),e.$render())}),d.to&&b.$watch("to",function(a,b){a!==b&&(e.$render(),console.log("to changed",a))})}}}]),angular.module("ez.datetime").directive("ezDatetimeControl",["EzDatetimeService","$parse","$timeout","$modal",function(a,b,c,d){return{restrict:"EA",require:"ngModel",scope:{ngModel:"=",from:"=?",to:"=?",config:"=?"},link:function(e,f,g,h){e.form={},f.addClass("ez-datetime-control"),a.resolveConfig(e,g),h.$formatters.push(function(a){return a&&("string"!=typeof a||isNaN(a)||(a=parseInt(a,10)),a=e.options.rangeEnabled&&"default"===e.options.modelBinding?moment(a.from).format(e.options.viewFormat)+" - "+moment(a.to).format(e.options.viewFormat):moment(a).format(e.options.viewFormat)),a}),f.bind("click",function(){e.form.date=h.$modelValue,e.form.date&&(e.form.date.from&&(e.form.from=e.form.date.from),e.form.date.to&&(e.form.to=e.form.date.to)),e.form.from=e.from,e.form.to=e.to,e.form.isFrom=!!g.to&&!!e.form.to,e.form.isTo=!!g.from&&!!e.form.from,d.open({templateUrl:e.options.rangeEnabled?"ez_datetime_range_modal.html":"ez_datetime_modal.html",controller:"EzDatetimeModalController",scope:e}).result.then(function(){if(e.from=e.form.from,e.to=e.form.to,e.options.rangeEnabled)switch(e.options.modelBinding){case"default":e.ngModel={from:e.from,to:e.to};break;case"from":e.ngModel=e.from;break;case"to":e.ngModel=e.to}else e.ngModel=e.form.date;g.ngChange&&c(function(){b(g.ngChange)(e.$parent)}),h.$setDirty()})})}}}]),angular.module("ez.datetime").directive("ezTimePicker",["EzDatetimeService",function(a){return{restrict:"EA",require:"ngModel",templateUrl:"ez_datetime_time_picker.html",scope:{ngModel:"=",options:"=?"},link:function(b,c,d,e){function f(){b.data={hours:[],minutes:[],seconds:[]};for(var a=b.options.meridiemEnabled?1:0,c=b.options.meridiemEnabled?12:23;c>=a;)b.data.hours.push(a),a+=b.options.hourStep;for(var d=0;60>=d;)b.data.minutes.push(d),d+=b.options.minuteStep;for(var e=0;60>=e;)b.data.seconds.push(e),e+=b.options.secondStep}function g(a){e.$setViewValue(a.format(b.options.modelFormat)),e.$render()}a.resolveConfig(b,d),b.setHour=function(a){var c=moment(b.ngModel);c.hours(a),g(c)},b.setMinute=function(a){var c=moment(b.ngModel);c.minutes(a),g(c)},b.setSecond=function(a){var c=moment(b.ngModel);c.seconds(a),g(c)},b.toggleMeridiem=function(){var a=moment(b.ngModel);a.hours()>12?a.hours(a.hours()-12):a.hours(a.hours()+12),g(a)},f()}}}]),angular.module("ez.datetime").filter("ezDate",[function(){return function(a,b){return a?(isNaN(a)||(a=parseInt(a,10)),moment(a).format(b)):void 0}}]),angular.module("ez.datetime").service("EzDatetimeService",["$parse","EzDatetimeConfig",function(a,b){return{resolveConfig:function(c,d){if(d.options)return c.options;c.options=angular.extend({},b,c.config);for(var e in b)d.hasOwnProperty(e)&&("boolean"==typeof b[e]?c.options[e]=a(d[e])(c.$parent):c.options[e]=d[e])}}}]);